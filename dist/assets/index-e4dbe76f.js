import{y as pe,z as ge,aA as j,H as B,O as p,C as x,aB as q,r as i,K as he,A as be,M as ve,j as l,a as t,N as ye,Q as Ce,aC as Pe,aD as ke,F as I,aE as Ue,c as S,b as xe,ag as Ne,L as Se,aF as _e,aG as Le,aH as $e,aI as we,a4 as Re,aJ as Ie,d as R,$ as _,aK as ae,p as Be,e as Te}from"./index-3dc75cc8.js";import{T as Me}from"./TextField-fc574086.js";function Fe(e){return pe("MuiLinearProgress",e)}ge("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const De=["className","color","value","valueBuffer","variant"];let N=e=>e,te,oe,ne,se,ie,le;const E=4,Ee=j(te||(te=N`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),je=j(oe||(oe=N`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),qe=j(ne||(ne=N`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),Ae=e=>{const{classes:r,variant:a,color:n}=e,b={root:["root",`color${p(n)}`,a],dashed:["dashed",`dashedColor${p(n)}`],bar1:["bar",`barColor${p(n)}`,(a==="indeterminate"||a==="query")&&"bar1Indeterminate",a==="determinate"&&"bar1Determinate",a==="buffer"&&"bar1Buffer"],bar2:["bar",a!=="buffer"&&`barColor${p(n)}`,a==="buffer"&&`color${p(n)}`,(a==="indeterminate"||a==="query")&&"bar2Indeterminate",a==="buffer"&&"bar2Buffer"]};return Ce(b,Fe,r)},A=(e,r)=>r==="inherit"?"currentColor":e.vars?e.vars.palette.LinearProgress[`${r}Bg`]:e.palette.mode==="light"?Pe(e.palette[r].main,.62):ke(e.palette[r].main,.5),ze=B("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,r)=>{const{ownerState:a}=e;return[r.root,r[`color${p(a.color)}`],r[a.variant]]}})(({ownerState:e,theme:r})=>x({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:A(r,e.color)},e.color==="inherit"&&e.variant!=="buffer"&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},e.variant==="buffer"&&{backgroundColor:"transparent"},e.variant==="query"&&{transform:"rotate(180deg)"})),Oe=B("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,r)=>{const{ownerState:a}=e;return[r.dashed,r[`dashedColor${p(a.color)}`]]}})(({ownerState:e,theme:r})=>{const a=A(r,e.color);return x({position:"absolute",marginTop:0,height:"100%",width:"100%"},e.color==="inherit"&&{opacity:.3},{backgroundImage:`radial-gradient(${a} 0%, ${a} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})},q(se||(se=N`
    animation: ${0} 3s infinite linear;
  `),qe)),Ve=B("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,r)=>{const{ownerState:a}=e;return[r.bar,r[`barColor${p(a.color)}`],(a.variant==="indeterminate"||a.variant==="query")&&r.bar1Indeterminate,a.variant==="determinate"&&r.bar1Determinate,a.variant==="buffer"&&r.bar1Buffer]}})(({ownerState:e,theme:r})=>x({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:e.color==="inherit"?"currentColor":(r.vars||r).palette[e.color].main},e.variant==="determinate"&&{transition:`transform .${E}s linear`},e.variant==="buffer"&&{zIndex:1,transition:`transform .${E}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&q(ie||(ie=N`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),Ee)),Ke=B("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,r)=>{const{ownerState:a}=e;return[r.bar,r[`barColor${p(a.color)}`],(a.variant==="indeterminate"||a.variant==="query")&&r.bar2Indeterminate,a.variant==="buffer"&&r.bar2Buffer]}})(({ownerState:e,theme:r})=>x({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},e.variant!=="buffer"&&{backgroundColor:e.color==="inherit"?"currentColor":(r.vars||r).palette[e.color].main},e.color==="inherit"&&{opacity:.3},e.variant==="buffer"&&{backgroundColor:A(r,e.color),transition:`transform .${E}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&q(le||(le=N`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),je)),He=i.forwardRef(function(r,a){const n=he({props:r,name:"MuiLinearProgress"}),{className:b,color:v="primary",value:c,valueBuffer:L,variant:d="indeterminate"}=n,y=be(n,De),u=x({},n,{color:v,variant:d}),f=Ae(u),$=ve(),C={},g={bar1:{},bar2:{}};if((d==="determinate"||d==="buffer")&&c!==void 0){C["aria-valuenow"]=Math.round(c),C["aria-valuemin"]=0,C["aria-valuemax"]=100;let m=c-100;$&&(m=-m),g.bar1.transform=`translateX(${m}%)`}if(d==="buffer"&&L!==void 0){let m=(L||0)-100;$&&(m=-m),g.bar2.transform=`translateX(${m}%)`}return l(ze,x({className:ye(f.root,b),ownerState:u,role:"progressbar"},C,{ref:a},y,{children:[d==="buffer"?t(Oe,{className:f.dashed,ownerState:u}):null,t(Ve,{className:f.bar1,ownerState:u,style:g.bar1}),d==="determinate"?null:t(Ke,{className:f.bar2,ownerState:u,style:g.bar2})]}))}),We=He;function Je(e){return e.trigger?t("div",{className:"popup",children:l("div",{className:"popup-inner",children:[t("button",{className:"close-btn",onClick:()=>e.setTrigger(!1),children:"close"}),e.children]})}):""}const Qe={width:300,facingMode:"enviroment"};function Xe(){const e=i.useRef(null),[r,a]=i.useState(null),n=i.useCallback(async()=>{const c=e.current.getScreenshot();a(c)},[e]);return l(I,{children:[t("div",{className:"takePic",children:t("p",{children:"Take Picture"})}),t(Ue,{ref:e,audio:!1,screenshotFormat:"image/png",videoConstraints:Qe,onUserMedia:c=>{},mirrored:!0,screenshotQuality:10}),l("div",{className:"buttonControls",children:[l("div",{className:"cameraBtn",children:[t("button",{onClick:n,children:"Capture"}),t("button",{onClick:()=>a(null),children:"Refresh"})]}),r&&l("div",{className:"outputContainer",children:[t("img",{src:r,alt:"Screenshot"}),t("button",{onClick:()=>{const c=document.createElement("a");c.href=r,c.download="captured_image.png",c.click()},children:"Save"})]})]})]})}function Ze(e){var Q,X,G,Y;const[r,a]=i.useState(0),[n,b]=i.useState(null),[v,c]=i.useState(""),[L,d]=i.useState(0),[y,u]=i.useState(!1),[f,$]=i.useState([]),[C,g]=i.useState(!0),[m,z]=i.useState(!1),[O,ce]=i.useState(!1),[T,V]=i.useState(""),[w,K]=i.useState("#fff"),M=(X=(Q=S)==null?void 0:Q.currentUser)==null?void 0:X.displayName,H=(Y=(G=S)==null?void 0:G.currentUser)==null?void 0:Y.photoURL,F=i.useRef(null),{enqueueSnackbar:P}=xe(),de=()=>{a(r===0?f.length-1:r-1)},ue=()=>{a(r===f.length-1?0:r+1)},fe=s=>{K(s.hex)};i.useEffect(()=>{var o;async function s(){const h=await Re();V(h.username),h.hasOwnProperty("storyTimestamp")&&ce(!0)}(o=S)!=null&&o.currentUser.isAnonymous?V("guest"):s()},[]);const me=s=>{let o=s.target.files;if(o.length<1){P("Select min 1 image!",{variant:"error"}),g(!1),s.stopPropagation();return}for(let k of o)if(!k.name.match(/\.(jpg|jpeg|png|gif|svg)$/))return P("Select a valid image!",{variant:"error"}),g(!1),!1;g(!0),b(Array.from(o));const h=[];for(let k of o)h.push(URL.createObjectURL(k));$(h),K("#fff")},W=async(s,o="")=>{var k,Z,ee,re;const h=w==="#fff"?null:w;try{if(s==="Post"){const D=(await R.collection("posts").add({timestamp:_.firestore.FieldValue.serverTimestamp(),caption:v,imageUrl:o,username:T,background:h,displayName:e.user.displayName,avatar:e.user.photoURL,likecount:[],uid:(Z=(k=S)==null?void 0:k.currentUser)==null?void 0:Z.uid})).id;await R.collection("users").doc(e.user.uid).update({posts:_.firestore.FieldValue.arrayUnion(D)}),ae({posts:_.firestore.FieldValue.arrayUnion(D)})}else{await R.collection("story").add({caption:v,imageUrl:o,background:h,username:T,uid:(re=(ee=S)==null?void 0:ee.currentUser)==null?void 0:re.uid});const U=await R.collection("users").where("username","==",T).get();U.empty||(await U.docs[0].ref.update({storyTimestamp:_.firestore.FieldValue.serverTimestamp()}),ae({storyTimestamp:_.firestore.FieldValue.serverTimestamp()}))}Be(),P(`${s} uploaded successfully!`,{variant:"success"}),d(0),c(""),b(null),F.current&&(F.current.value=null),e.onUploadComplete&&e.onUploadComplete()}catch(U){Te(),P(U.message,{variant:"error"}),e.onUploadError&&e.onUploadError(U)}finally{u(!1)}};function J(s){if(!n&&!v||!C)return P("Upload valid image and caption!",{variant:"error"}),!1;if(u(!0),e.onUploadStart&&e.onUploadStart(),!n){W(s);return}Ie(n,{generateThumbnails:!0,onUploadProgress(o){d(o),e.onUploadProgress&&e.onUploadProgress(o)}}).then(o=>{W(s,JSON.stringify(o))}).catch(o=>{P(o.message,{variant:"error"}),u(!1),e.onUploadError&&e.onUploadError(o)}).finally(()=>{e.onUploadEnd&&e.onUploadEnd()})}return t(I,{children:l("div",{style:{display:"flex",flexDirection:"column",position:"sticky"},children:[y&&n&&t(We,{variant:"determinate",value:L}),l("div",{style:{display:"flex",flexDirection:"column"},children:[t("div",{className:"post-header",children:H&&M&&l(I,{children:[" ",t(Ne,{className:"post__upload__avatar",alt:M,src:H,sx:{bgcolor:"royalblue",border:"2px solid transparent",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer","&:hover":{boxShadow:"rgba(100, 100, 111, 0.2) 0px 7px 17px 0px",border:"2px solid black",scale:"1.1"}}}),t(Se,{style:{textDecoration:"none"},children:t("h3",{className:"post__username",children:M})})]})}),!n&&l("div",{className:"file-input",style:{flexDirection:"row"},children:[l("div",{className:"upload-picture",children:[t("input",{type:"file",className:"file",name:"file",id:"file",onChange:me,multiple:!0,accept:"image/*",ref:F,disabled:y}),t("label",{htmlFor:"file",children:"Upload Picture"})]}),l("div",{className:"popupMain",children:[t("button",{className:"openpopup",onClick:()=>z(!0),children:"Take Picture"}),t(Je,{trigger:m,setTrigger:z,children:t(Xe,{})})]})]}),n&&t("div",{className:"slider__View",style:{width:"90%"},children:f.map((s,o)=>l("div",{style:{display:o===r?"contents":"none"},className:o===r?"slide active":"slide",children:[t(_e.LazyLoadImage,{className:"image",src:s,effect:"blur",alt:" upload",delayTime:1e3,style:{width:"100%",height:"100%",objectFit:"cover",maxHeight:"220px"}}),f.length>1?l("div",{className:"sliders_button",children:[t(Le,{className:"slider_circle",onClick:de}),t($e,{className:"slider_chevron",onClick:ue})]}):t(I,{})]},s))}),t("hr",{}),l("div",{className:"caption-container",children:[t(Me,{className:"create-post-input",onChange:s=>c(s.target.value),value:v,variant:"filled",label:"Write a caption...",multiline:!0,rows:8,disabled:y,inputProps:{maxLength:200},sx:{width:"100%","& .MuiFormLabel-root.Mui-focused":{fontWeight:"bold"},"& .MuiFilledInput-root":{background:w,color:"var(--color)"}},style:{color:"var(--color) !important"}}),t("div",{children:!n&&t(we,{color:w,onChange:fe,height:"12px",width:"100%"})})]}),t("hr",{}),l("div",{className:"shareBtnContainer",children:[t("button",{onClick:()=>J("Post"),disabled:y,className:"share__button",children:"Add Post"}),t("button",{onClick:()=>J("Story"),disabled:y||O,className:`share__button ${O?"disable_post_btn":null}`,children:"Create Story"})]})]})]})})}export{Ze as default};
