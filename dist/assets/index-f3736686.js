import{r as u,u as E,b as k,j as i,F as S,a,L as b,a0 as C,$ as m,d as y,a4 as P,a5 as U}from"./index-1a3dc146.js";const x=({user:e})=>{const[w,f]=u.useState(!1),[h,N]=u.useState(""),[_,o]=u.useState(!1),A=E(),{enqueueSnackbar:l}=k();async function g(){var c;const t=(c=e==null?void 0:e.providerData[0])==null?void 0:c.providerId;if(t){let r;o(!0),t==="google.com"?r=new m.auth.GoogleAuthProvider:r=new m.auth.FacebookAuthProvider;try{await e.reauthenticateWithPopup(r),await p()}catch(n){l(`Error: ${n}`,{variant:"error"}),o(!1)}}else if(e!=null&&e.email&&h!==""){o(!0);const r=m.auth.EmailAuthProvider.credential(e.email,h);try{await e.reauthenticateWithCredential(r),await p()}catch(n){l(`Error: ${n}`,{variant:"error"}),o(!1)}}else l("Error: Invalid credentials",{variant:"error"})}async function p(){let t=[];try{const c=y.batch(),r=await P();r&&(r.photoURL&&t.push(r.photoURL),r.bgImageUrl&&t.push(r.bgImageUrl)),c.delete(userDocRef);const n=await y.collection("posts").where("uid","==",e==null?void 0:e.uid).get();n.empty||n.forEach(s=>{const d=s.data().imageUrl;if(d&&d!==""){const v=JSON.parse(d);v&&v.forEach(I=>{t.push(I.imageUrl)})}c.delete(s.ref)}),await c.commit(),await e.delete();const D=t.map(async s=>{if(s!=="")try{await U(s)}catch(d){console.error(`Error deleting image: ${d}`)}});await Promise.all(D),localStorage.removeItem("user"),A("/login"),l("User deleted successfully",{variant:"success"})}catch(c){console.error(`Error handling delete: ${c}`),l(`Error: ${c}`,{variant:"error"})}finally{o(!1)}}return i(S,{children:[a("div",{className:"delete_account_main_container",children:i("div",{className:"delete_account_sub_container",children:[i("div",{className:"delete_account_heading",children:[a("h1",{children:"Delete Your Account"}),a("p",{children:"We're sorry to see you leaving"})]}),i("div",{className:"delete_account_body",children:[a("h3",{className:"delete_account_body_heading",children:"Before you go..."}),i("ul",{className:"delete_account_body_list",children:[i("li",{children:["If you're sick of getting email notification"," ",a(b,{children:"disable them here."})]}),i("li",{children:["If you want to change username you can"," ",a(b,{children:"do that here."})]}),a("li",{children:"Account deletion is final. There will be no way to restore your account."})]})]}),a("div",{className:"delete_account_action_btn_container",children:a("button",{className:"delete_account_action_btn delete_account_action_delete_btn",onClick:()=>{var t;(t=e==null?void 0:e.providerData[0])!=null&&t.providerId?g():f(!0)},children:"Delete my account"})})]})}),w&&a(C,{onClickAway:()=>f(!1),children:i("div",{className:"delete_acc_pass",children:[a("label",{htmlFor:"user-password",children:"Enter Your Password:"}),a("input",{type:"password",name:"user-password",id:"user-password",value:h,onChange:t=>N(t.target.value)}),a("button",{className:`confirm_delete_acc_btn ${_?"disable_confirm_btn":""}`,onClick:g,disabled:_,children:"Confirm"})]})})]})};export{x as default};
