import{r as f,b as S,d as i,c as w,j as r,F as p,a as n,i as E,k as $,U as B,L as D,$ as b}from"./index-1a3dc146.js";function A(){const[d,N]=f.useState([]),[g,R]=f.useState(!0),{enqueueSnackbar:u}=S(),v=async e=>{try{const c=await i.collection("users").doc(e).get();return c.exists?c.data():null}catch(t){return console.error("Error fetching doc: ",t),null}};f.useEffect(()=>{var t,c;const e=i.collection("users").doc((c=(t=w)==null?void 0:t.currentUser)==null?void 0:c.uid).collection("notifications").orderBy("timestamp","desc").onSnapshot(async s=>{const o=[];for(const a of s.docs){const{sender:l,recipient:x,message:k}=a.data(),m=await v(l);if(m){const{photoURL:F,username:q,name:L}=m;o.push({id:a.id,sender:l,recipient:x,photoURL:F,username:q,name:L,message:k})}}N(o),R(!1)});return()=>e()},[]);async function h(e,t,c){const s=i.batch(),o=i.collection("users").doc(e).collection("friendRequests").doc(t),a=i.collection("users").doc(e).collection("notifications").doc(t);s.delete(o),s.delete(a),s.commit().then(()=>{u(`Friend Request ${c?"Accepted":"Declined"}!`,{variant:"success"})}).catch(l=>{u(`Error Occurred: ${l}`,{variant:"error"})})}async function y(e,t){const c=i.batch(),s=i.collection("users").doc(e),o=i.collection("users").doc(t);c.update(s,{Friends:b.firestore.FieldValue.arrayUnion(t)}),c.update(o,{Friends:b.firestore.FieldValue.arrayUnion(e)}),await h(e,t,!0),await c.commit().catch(a=>{u(`Error Occurred: ${a}`,{variant:"error"})})}return r(p,{children:[n(E,{}),g?n("div",{className:"loader-container",children:n($,{})}):n("div",{className:"notification-container",children:n(B,{children:n("div",{className:"profile__favourites",style:{marginBlock:"1.5rem"},align:"center",children:d.length?r(p,{children:[r("h1",{className:"notification-heading",children:["Notifications"," ",n("span",{className:"notification-count",children:d.length})]}),d.map(e=>{const{id:t,message:c,username:s,name:o,photoURL:a}=e;return r("div",{className:"notif-message-container",children:[n("img",{src:a,alt:o,style:{width:"80px",height:"80px",borderRadius:"50%"}}),r("div",{className:"notif-message",children:[c," from"," ",r(D,{className:"friend-request-sender-name",to:`/user/${s||""}`,children:[o||"","."]}),r("div",{style:{marginTop:"10px"},children:[n("button",{className:"accept-btn notif-btn",onClick:()=>{y(e.recipient,e.sender)},children:"Accept"}),n("button",{className:"decline-btn notif-btn",onClick:()=>h(e.recipient,e.sender),children:"Decline"})]})]})]},t)})]}):n("p",{style:{color:"var(--color)"},children:"No notifications"})})})})]})}export{A as default};
