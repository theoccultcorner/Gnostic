import{j as f,a,r as i,b as H,u as J,e as b,d as v,c as u,m as K,p as A,s as x}from"./index-3dc75cc8.js";import{v as U,A as Q,a as P,b as C,c as X,f as Y,s as L}from"./signIn-91f6e678.js";const Z=({address:m,image:s,blank_profile:d,handleChange:l})=>f("div",{className:"input__group",children:[a("label",{htmlFor:"file",id:"file-label",children:a("div",{className:"img-outer",children:m?a("img",{src:URL.createObjectURL(s),alt:"profile pic",className:"img-inner"}):a("img",{src:d,alt:"profile pic",className:"img-inner"})})}),a("input",{type:"file",id:"file",className:"file",onChange:l,accept:"image/*",required:!0,"aria-labelledby":"file-label"})]}),se=()=>{const m=i.useRef(""),{enqueueSnackbar:s}=H(),d=J(),[l,R]=i.useState(""),[w,M]=i.useState(""),[y,T]=i.useState(""),[k,F]=i.useState(""),[o,O]=i.useState(null),[j,q]=i.useState(null),[p,E]=i.useState(!0),[h,D]=i.useState(""),[r,I]=i.useState(U.initialValue);function W(e,n=300){let t;return(...g)=>{clearTimeout(t),t=setTimeout(()=>{e.apply(this,g)},n)}}const $=()=>{const e=m.current;/^[a-z][a-z0-9_]{4,20}$/.test(e)?W(z)():E(!1)},z=async()=>{const e=m.current;(await v.collection("users").where("username","==",e).get()).empty?E(!0):(E(!1),s("Sorry, this username is already in use. Please try another username.",{variant:"error"}))},B=e=>{e.target.files[0]&&(O(e.target.files[0]),q(e.target.value))},G=async e=>{e.preventDefault();let n=!0;if(Object.values(r).forEach(t=>{t!==!1&&(n=!1)}),h!==""&&(n=!1),!p){b(),s("Username not available!",{variant:"error"});return}if(n){const t=v.collection("users"),g=v.doc(`usernames/${h}`),N=v.batch();await u.createUserWithEmailAndPassword(w,y).then(async S=>{await K(u.currentUser,{displayName:l}).then(N.set(g,{uid:u.currentUser.uid})).then(N.commit()).then(await t.doc(u.currentUser.uid).set({uid:u.currentUser.uid,username:h,name:l,email:w,photoURL:u.currentUser.photoURL,posts:[],friends:[u.currentUser.uid]})).then(()=>{A(),s(`Congratulations ${l},you have joined Dummygram`,{variant:"success"}),d("/")}).catch(c=>{b(),s(c.message,{variant:"error"})}),x.ref(`images/${o==null?void 0:o.name}`).put(o).on("state_changed",()=>{},c=>{b(),s(c.message,{variant:"error"})},()=>{x.ref("images").child(o==null?void 0:o.name).getDownloadURL().then(c=>{S.user.updateProfile({displayName:l,photoURL:c}),A(),s("Signup Successful!",{variant:"success"})}).catch(c=>console.error(c))})}).catch(S=>{b(),s(S.message,{variant:"error"})})}else s("Please fill all fields with valid data",{variant:"error"})},V=()=>{d("/login")},_=(e,n)=>{let t=U[e](n);e==="confirmPassword"&&(t=U.confirmPassword(n,y)),I(g=>({...g,...t}))};return a(Q,{children:a("form",{"aria-label":"Sign Up Form",children:f("div",{className:"form__bottom signup-container",children:[a(Z,{address:j,blank_profile,image:o,handleChange:B}),a(P,{label:"Username",id:"username",placeholder:"Enter your Username",value:h,handleChange:e=>{m.current=e.target.value.trim(),D(e.target.value.trim()),$()},maxLength:18,fieldName:"username",aria_dsc_by:"username-error",isError:!p,errorMesssage:h.length?"Username is invalid":"Username cannot be empty",error_border:p,successMessage:"Perfect!"}),!p&&f("div",{className:"username-rules",children:["A valid username must",f("ul",{children:[a("li",{children:"NOT contain captial letters."}),a("li",{children:"NOT contain special characters."}),a("li",{children:"NOT start with a digit."}),a("li",{children:"be between 4 and 20 letters long."}),a("li",{children:"NOT be registered."})]})]}),a(P,{label:"Full name",id:"full__name",placeholder:"Enter your Fullname",value:l,handleChange:e=>{R(e.target.value),_(e.target.name,e.target.value)},maxLength:40,fieldName:"name",aria_dsc_by:"name-error",isError:r.name&&r.nameError,errorMesssage:r.nameError,error_border:!r.nameError,successMessage:"Perfect!"}),a(P,{label:"Email",id:"email",type:"email",placeholder:"Enter your email",value:w,handleChange:e=>{M(e.target.value),_(e.target.name,e.target.value)},maxLength:64,fieldName:"email",aria_dsc_by:"email-error",isError:r.email&&r.emailError,errorMesssage:r.emailError,error_border:!r.emailError,successMessage:"Perfect!"}),f("div",{className:"pass-container-both",children:[a(C,{label:"Password",id:"password",name:"password",placeholder:"Enter your password",value:y,handleChange:e=>{T(e.target.value),_(e.target.name,e.target.value)},maxLength:30,aria_dsc_by:"password-error",errorMesssage:r.passwordError,successMessage:"Perfect!",isError:r.password&&r.passwordError}),a(C,{label:"Confirm Password",id:"confirmpassword",name:"confirmPassword",placeholder:"Confirm your Password",value:k,handleChange:e=>{F(e.target.value),_(e.target.name,e.target.value)},maxLength:30,aria_dsc_by:"confirm-password-error",errorMesssage:r.confirmPasswordError,successMessage:"Perfect!",isError:r.confirmPassword&&r.confirmPasswordError})]}),a(X,{handleSubmit:G,btn__label:"Sign up",submit__icon:Y,handleSignInWithGoogle:e=>L(e,s,d),handleSignInWithFacebook:e=>L(e,s,d,!1),have_acct_question:"Already have an account?",have_acct_nav:V,have__acct_action:"Sign in"})]})})})};export{se as default};
